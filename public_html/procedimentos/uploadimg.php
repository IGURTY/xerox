<?php
/*
Copyright (c) 2024 Jumptec
Se quiser obter a licença para esse produto, acesse https://www.jumptec.com.br
*/
 session_start(); ini_set("allow_url_fopen", "Off"); header("Pragma: no-cache");header("Cache: no-cache"); error_reporting(E_ERROR); ini_set("display_errors", 0);  if (isset($_SERVER['HTTP_REFERER'])){ if (!strstr($_SERVER['HTTP_REFERER'], 'xn--simuladorcriaconfeces-k4b63a')){  exit;}}  function f1c6ef092c780($v90ff2112fb64, $vdd95bbec198b){ echo '{'; echo ' "sucesso" : '.(int)$v90ff2112fb64.','; if($v90ff2112fb64==1){  $vec0da516fc28=array($vf836384fd401, $vb0add5590a49, $vb306b5229083, $v97ba85fde1c1, $v0568f481eee0);  $v59233e47401c=reset($_SESSION['camada_imagem']);    echo' "imagem" :{   "arquivo": "'.$v59233e47401c[0].'",    "largura": "'.$v59233e47401c[1].'",    "altura": "'.$v59233e47401c[2].'",    "info": "'.$v59233e47401c[3].'",    "lado": "'.$v59233e47401c[4].'",    "galeria": "'.((empty($_GET['galeria'])) ? 0 : 1).'"   },';} echo ' "mensagem" : "'.$vdd95bbec198b.'"'; echo '}';}  if(empty($_SESSION['camada_imagem'])) $_SESSION['camada_imagem']=array(); $vef126de3675f=$v2e6e92499af8=array();  if(empty($_GET['galeria'])){ $v763975fa0236=isset($_FILES["imagem"]) ? $_FILES["imagem"] : FALSE;   $v2e6e92499af8["tamanho"]=5000000; $v2e6e92499af8["largura"]=20000; $v2e6e92499af8["altura"]=10000;  $v41605a469b27=array('jpeg','jpg','png','gif','pdf'); $vdcff8496e357=array('image/jpeg', 'image/jpg', 'image/png','image/gif', 'application/pdf');  $v5aced229670a=pathinfo($v763975fa0236['name']); $va0927c1301e0=strtolower($v5aced229670a['extension']);   if (!in_array($va0927c1301e0, $v41605a469b27) || !in_array($v763975fa0236["type"], $vdcff8496e357)){  $vef126de3675f[]="Arquivo em formato inválido! A imagem deve ser jpg, jpeg, gif ou png. Envie outro arquivo";} else { if($v763975fa0236["size"]>$v2e6e92499af8["tamanho"])  {  $vef126de3675f[]="Arquivo em tamanho muito grande! A imagem deve ser de no máximo " . $v2e6e92499af8["tamanho"] . " bytes. Envie outro arquivo"; }    if($va0927c1301e0 !='pdf'){  $vaa3e13f4d3fa=getimagesize($v763975fa0236["tmp_name"]);     if (!($vaa3e13f4d3fa[0]>1 && $vaa3e13f4d3fa[1]>1)){   $vef126de3675f[]="Dimensão inválida."; }  else{   if($vaa3e13f4d3fa[0]>$v2e6e92499af8["largura"])   {   $vef126de3675f[]="Largura da imagem não deve ultrapassar " . $v2e6e92499af8["largura"] . " pixels";  }   if($vaa3e13f4d3fa[1]>$v2e6e92499af8["altura"])   {   $vef126de3675f[]="Altura da imagem não deve ultrapassar " . $v2e6e92499af8["altura"] . " pixels";  } } }} if(sizeof($vef126de3675f)) {  foreach($vef126de3675f as $v1b33f70f787a)  {  $vccd17c15bc78 .=" - " . $v1b33f70f787a . "<BR>"; }   f1c6ef092c780(0, $vccd17c15bc78);  exit;} else {  $vda131204afe6=md5(uniqid(time()));  $v05f4ba78786a=$vda131204afe6 . "." . $va0927c1301e0;    $v665e4d9250a3="../geradas/uploads/" . $v05f4ba78786a; move_uploaded_file($v763975fa0236["tmp_name"], $v665e4d9250a3); if (preg_match("/\.(pdf){1}$/i", $v763975fa0236["name"])){  $vb7ef00f10c8d=$vda131204afe6 . ".png";  $v415a12e6bf22="../geradas/uploads/" . $vb7ef00f10c8d;    $ve2dfff065d52=new Imagick();  $ve2dfff065d52->setResolution(150, 150);  $ve2dfff065d52->readImage($v665e4d9250a3.'[0]');  $ve2dfff065d52=$ve2dfff065d52->flattenImages();  $ve2dfff065d52->writeImages($v415a12e6bf22, true);     $vaa3e13f4d3fa=getimagesize($v415a12e6bf22);   unlink($v665e4d9250a3); }    $vdd95bbec198b="Sua foto foi enviada com sucesso!";}} else{ $vbca88a83c263=$_GET['galeria']; $v329f42e17b32=$_GET['imagem'];   if(strstr($v329f42e17b32, 'galeria')==true){  $v665e4d9250a3="../..".$v329f42e17b32;} else{  $v665e4d9250a3=$v329f42e17b32;}   $va0927c1301e0=substr(end(explode('.',$v665e4d9250a3)), 0, 3);   $vaa3e13f4d3fa=getimagesize($v665e4d9250a3);   $vdd95bbec198b="Sua foto resgatada com sucesso!";}   if ($va0927c1301e0=='jpg' || $va0927c1301e0=='jpeg'){ $v3da98ee90b0c=imagecreatefromjpeg($v665e4d9250a3);} else if (strtolower($va0927c1301e0)=='png'){ $v3da98ee90b0c=imagecreatefrompng($v665e4d9250a3);} else if ($va0927c1301e0=='gif'){ $v3da98ee90b0c=imagecreatefromgif($v665e4d9250a3);} else if ($va0927c1301e0=='pdf'){ $v3da98ee90b0c=imagecreatefrompng($v415a12e6bf22);}  $v98e76f304f8d=$_REQUEST['l_padrao'];  $vb0add5590a49=ceil($_REQUEST['l_padrao'] * 0.75); $vb306b5229083=ceil($_REQUEST['h_padrao'] * 0.75);  if($vaa3e13f4d3fa[0]<=$vb0add5590a49 && $vaa3e13f4d3fa[0]>0){ $vb0add5590a49=$vaa3e13f4d3fa[0]; $v98e76f304f8d=$vaa3e13f4d3fa[0];} if($vaa3e13f4d3fa[1]<=$vb306b5229083 && $vaa3e13f4d3fa[0]>0){  $vb306b5229083=$vaa3e13f4d3fa[1];}  if(!empty($_GET['w']) && !empty($_GET['h'])){ $vc045b5cb2ea9=(int)$_GET['w']; $vd238541d39b5=(int)$_GET['h'];} else{ if($vaa3e13f4d3fa[0]>=$vaa3e13f4d3fa[1]){  if($vaa3e13f4d3fa[0]>$vb0add5590a49){  $vc045b5cb2ea9=$vb0add5590a49; }  else{  $vc045b5cb2ea9=$vaa3e13f4d3fa[0]; }    if($vaa3e13f4d3fa[1]>$vb306b5229083 || $vaa3e13f4d3fa[0]>$vb0add5590a49){  $vd238541d39b5=($vaa3e13f4d3fa[1] * $vc045b5cb2ea9) / $vaa3e13f4d3fa[0]; }  else{  $vd238541d39b5=$vaa3e13f4d3fa[1]; }} else{  if($vaa3e13f4d3fa[1]>$vb306b5229083){  $vd238541d39b5=$vb306b5229083; }  else{  $vd238541d39b5=$vaa3e13f4d3fa[1]; }    if($vaa3e13f4d3fa[1]>$vb306b5229083 || $vaa3e13f4d3fa[0]>$vb0add5590a49){  $vc045b5cb2ea9=($vaa3e13f4d3fa[0] * $vd238541d39b5) / $vaa3e13f4d3fa[1]; }  else{  $vc045b5cb2ea9=$vaa3e13f4d3fa[0]; }}}  if(!empty($_GET['x']) && !empty($_GET['y'])){ $vb1c42d66c16f=(int)$_GET['x']; $vd05d044fd22f=(int)$_GET['y'];} else{ if($vc045b5cb2ea9<$vb0add5590a49){  $vb1c42d66c16f=($vb0add5590a49 - $vc045b5cb2ea9) / 2;} else{  $vb1c42d66c16f=0;}   if($vd238541d39b5<$vb306b5229083){  $vd05d044fd22f=($vb306b5229083 - $vd238541d39b5) / 2;} else{  $vd05d044fd22f=0;}}   $v28c32980356d=imageistruecolor($v3da98ee90b0c);   if ( $v28c32980356d ){ $vd2cb5030ba00=imagecreatetruecolor( $vb0add5590a49, $vb306b5229083 ); imagealphablending($vd2cb5030ba00, true); $v7d39dd432906=imagecolorallocatealpha( $vd2cb5030ba00, 255, 255, 255, 127); imagefill( $vd2cb5030ba00, 0, 0, $v7d39dd432906 ); imagesavealpha ( $vd2cb5030ba00 , true );} else{ $vd2cb5030ba00=imagecreate( $vb0add5590a49, $vb0add5590a49 ); $v99e54106c348=imagecolortransparent($v3da98ee90b0c); $v09d9454aff0d=array('red'=>255, 'green'=>255, 'blue'=>255); if ($v99e54106c348>=0){  $v09d9454aff0d=imagecolorsforindex($v3da98ee90b0c, $v99e54106c348);  } $v99e54106c348=imagecolorallocate($vd2cb5030ba00, $v09d9454aff0d['red'], $v09d9454aff0d['green'], $v09d9454aff0d['blue']); imagefill($vd2cb5030ba00, 0, 0, $v99e54106c348); imagecolortransparent($vd2cb5030ba00, $v99e54106c348);}  imagecopyresampled($vd2cb5030ba00, $v3da98ee90b0c, $vb1c42d66c16f, $vd05d044fd22f, 0, 0, $vc045b5cb2ea9, $vd238541d39b5, imagesx($v3da98ee90b0c), imagesy($v3da98ee90b0c) );  $vf836384fd401='geradas/temp/imagem-'.time().'.png';  if($_GET['galeria']=='tema' && !empty($_POST['info'])) { $v97ba85fde1c1=$_POST['info'];}  $v0568f481eee0=$_REQUEST['lado'];  $vec0da516fc28=array($vf836384fd401, $vb0add5590a49, $vb306b5229083, $v97ba85fde1c1, $v0568f481eee0, $v665e4d9250a3); array_unshift($_SESSION['camada_imagem'], $vec0da516fc28);  imagepng($vd2cb5030ba00, '../'.$vf836384fd401);  f1c6ef092c780(1, $vdd95bbec198b);?>